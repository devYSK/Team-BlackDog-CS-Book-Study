

# 3.1 운영체제와 컴퓨터



### 운영체제란 

운영체제(Operating System)는 컴퓨터 시스템의 하드웨어, 소프트웨어적인 자원들을 효율적으로 운영 및 관리함으로써 사용자가 컴퓨터를 편리하고, 효과적으로 사용할 수 있도록 하는 `시스템 소프트웨어`이다. 

> 컴퓨터 하드웨어 |-- 운영체제 (OS) |-- 여러 소프트웨어들



컴퓨터 하드웨어 바로 위에 설치되어 사용자 및 다른 소프트웨어와 하드웨어를 연결하는 소프트웨어 계층 즉, 중개자 역할을 해주는 프로그램이다.



## 운영체제의 역할과 구조



### 운영채제의 역할

1. **자원관리**: 컴퓨터 시스템 자원 효율적 관리 
   * 시스템 자원 - CPU,  Memory, 파일,  I/O장치와 같은 하드웨어 자원과 프로세스 등의 소프트웨어 자원)
   * CPU 스케줄링과 프로세스 관리 : 
     * CPU 소유권을 어떤 프로세스 할당할지, 
     * 프로세스의 생성과 삭제, 
     * 자원 할당 및 반환
   * 메모리 관리 : 
     * 한정된 메모리를 어떤 프로세스에 얼만큼 할당해야 하는지,
   * I/O 디바이스 관리 : 마우스, 키보드, 컴퓨터 간에 데이터를 주고받는 것을 관리
   * 디스크 파일 관리 :
     * 디스크 파일을 어떠한 방법으로 보관할지 관리  
2. **자원 보호** : 프로그램이나 다른 사용자가 데이터를 삭제하거나 중요 파일에 접근하지 못하게 컴퓨터 자원들 보호
3. **인터페이스 제공**: 하드웨어 인터페이스와 사용자 인터페이스 제공하여 편리하게 사용하도록 지원



### **운영체제의 목적** - 응답시간 감소, 처리능력 향상, 사용 가능도 향상, 신뢰도 향상

| **응답시간 (Turnaround Time)** | **작업 의로 후 시스템에서 결과가 얻어질 때까지의 시간**      |
| ------------------------------ | ------------------------------------------------------------ |
| **처리능력 (Throughput)**      | **시스템의 생산성을 나태내는 단위. 일정시간 동안 처리하는 일의 양** |
| **사용 가능도(Availability)**  | **시스템을 얼마나 빠르게 사용할 수 있는가의 정도**           |
| **신뢰도 (Reliability)**       | **주어진 문제를 얼마나 정확하게 처리하는가의 정도**          |



### 운영체제의 구조

<img src="https://user-images.githubusercontent.com/41531594/205482339-16ff8ce2-744b-4462-b671-f9de5b0e1e4e.png" width = 700 height = 700>



> 유저 프로그램(응용 프로그램) - GUI - 시스템 콜(시스템 호출) - 커널 - 드라이버 - 하드웨어



#### GUI (인터페이스, 그래픽 유저 인터페이스)

* 커널에 사용자의 명령을 전달하고 실행 결과를 사용자에게 알려주는 역할

  * 사용자가 전자장치와 상호작용할 수 있도록 하는 사용자 인터페이스의 한 형태(여러 형태가 있다. )

  * 아이콘을 마우스로 클릭하는 등 



#### 시스템 콜 (시스템 호출)

> **시스템 호출** 또는 **시스템 콜**(system call), 간단히 **시스콜**(syscall)은   [운영 체제](https://ko.wikipedia.org/wiki/운영_체제)의 [커널](https://ko.wikipedia.org/wiki/커널_(컴퓨팅))이 제공하는 [서비스](https://ko.wikipedia.org/wiki/서비스)에 대해, [응용 프로그램](https://ko.wikipedia.org/wiki/응용_프로그램)의 요청에 따라 커널에 접근하기 위한 인터페이스 이며, 커널이 자신을 보호하기 위해 만든 인터페이스이다. 
>
> 커널은 사용자나 응용 프로그램으로부터 컴퓨터 자원을 보호하기 위해 자원에 직접 접근하는 것을 차단한다.
> 따라서 자원을 이용하기 위해서는 시스템 콜이라는 인터페이스를 사용하여 접근하여야 한다.
>
> 보통 C나 C++과 같은 [고급 언어](https://ko.wikipedia.org/wiki/고급_프로그래밍_언어)로 작성된 프로그램들은 직접 시스템 콜을 사용할 수 없기 때문에 고급 [API](https://ko.wikipedia.org/wiki/API)를 통해 사용한다.
>
> ex) printf 함수는 사용자가 시스템의 특정 위치에 문자를 출력할 수 있게 하는 시스템 콜이다.
>
> 



*  시스템(system)인 운영체제에게 유저가 어떤 기능(서비스)를 사용하게 해달라고 요청(call)할 때 사용하는 방법
*  운영체제가 커널에 접근하기 위한 인터페이스이며 유저 프로그램이 운영체제의 서비스를 받기 위해 커널 함수를 호출할 때 사용한다.
   * 커널 함수 :  OS의 주요 역할을 수행하는 함수들의 집합



운영체제는 **커널 모드(Kernel Mode)**와 **사용자 모드(User Mode)**로 나뉘어 구동된다



> OS는 컴퓨터 자원을 공유하기 때문에 시스템 안정성을 위해 특정 실행 모드에 맞는 기능만 수행할 수 있도록 모드를 만들었다.
>
> 운영체제 코드를 실행하는 모드와 사용자 코드를 실행하는 모드 2가지를 만들었고, 하드웨어에 모드 비트(Modie bit)란 놈이 있는데 modbit가  `0이면 커널 모드`,  `1이면 사용자 모드`다.  
>
> 용도에 따라 2개 이상의 모드를 사용할 수도 있으며 이를 Multimode operation 이라 부른다. 
>
> 최초에 부팅시 하드웨어는 커널 모드에서 시작한다. 
>
> 운영체제가 상주되고, 여기서 부터 사용자 모드가 시작된다. 
>
> 인터럽트 또는 트랩이 발생할 때마다 하드웨어는 모드 비트를 0으로 바꾸고 커널 모드로 전환하고, 처리가 끝나면 모드비트는 1로 바뀌며 사용자 모드로 전환된다. 



* Interrupt : 주변 장치와 커널이 통신하는 방식 중의 하나로, 주변 장치나 CPU가 자신에게 발생한 사건을 리눅스 커널에게 알리는 매커니즘.

  * 인터럽트란 어떤 신호가 들어왔을 때 인터럽트를 처리하기 위해 CPU를 잠깐 정지시키는 것

  * 비동기식 이벤트

  * 다른 하드웨어 장치가 CPU와 상관없이 발생시킴

  * keyboard event, I/O interrupt, timer ticks



* Trap : 소프트웨어 인터럽트 (트랩을 내부 인터럽트 또는 exception이라고 하는 경우도있다.)

  * 특별한 조건을 걸어 놓고 조건에 부합하는 상황이 걸리게 하는 역할
    * **시스템 콜** 또는 **예외**상황에서 발생

  - 각 상황에 맞는 handler 또는 서비스 루틴으로 매핑해줌

  - 시스템 콜 : 사용자가 의도적으로 발생시킨 인터럽트

  - 예외 : 메모리 참조 오류, 0으로 나누기, Overflow 등 프로세스 오류로 발생되는 인터럽트



* 커널 : **컴퓨터 과학에서 커널(Kernel)은 운영체제의 핵심 부분으로서, 운영 체제의 다른 부분 및 응용 프로그램 수행에 필요한 여러가시 서비스(시스템 콜 등)를 제공한다**

  * 커널의 역할 : **보안, 자원관리, 추상화**
  * 운영체제의 커널은  **자원을 효율적으로 관리**하기위해서 ***CPU 스케줄링, 메모리관리, 입출력관리, 파일시스템 관리\*** ***등의 업무\***를 수행
  * 모드 비트가 0으로 세팅되어 있으면 커널 모드로서 모든 명령을 수행할 수 있고, 모드 비트가 1로 세팅되어 있으면 사용자 모드

* 유저 모드 : 유저가 접근할 수 있는 영역을 제한적으로 두어 컴퓨터 하드웨어(또는 자원)에 함부로 침범하지 못하는 모드

* 커널 모드 : 모든 컴퓨터 자원(하드웨어)에 접근할 수 있는 모드 

  


> 프로세스가 유저모드에서 실행되다가 특별한 요청이 필요할때 system call을 이용해서 커널에 요청을 하면 올바른 I/O 요청인지 확인 후 유저 모드가 systemcall을 통해 커널 모드로 변환되어 실행된다



#### 예제

> ex) fs.readFile(); // 파일 시스템의 파일을 읽는 함수 

* 유저 모드에서 파일을 읽지 않고 커널 모드로 들어가 파일을 읽고 유저 모드로 리턴해주고 남은 유저 프로그램의 로직을 수행한다.
  * 이런 과정을 통해 컴퓨터 자원에 대한 직접 접근을 차단할 수 있고 (자원, 보안성) 프로그램을 다른 프로그램으로부터 보호할 수 있다. 



* **(유저모드 -> 커널모드 요청)**
  * 프로세스가 유저모드에서 실행되다가 특별한 요청이 필요할때 system call을 이용해서 커널에 요청을 합니다. 
* **(커널모드 -> 유저모드로 반환)**
  * system call의 요청을 받은 커널이 그 요청에 대한 일을 하고 결과값을 system call의 리턴 값으로 전해줍니다.



> ex) 유저 프로그램이 카메라 이용

1. 시스템 콜 호출  하면서 커널 모드로 변환 (이 때 modebit는 1-> 0으로 )
2. 커널 모드에서 시스템 콜 함수를 통한 카메라 자원 로직 수직 수행 후 시스템 콜 함수로 리턴값을 시스템콜을 호출한 유저 프로그램에 반환
3. 이후 유저 프로그램이 나머지 로직 실행 





#### 시스템 콜의 특징 (시스템 호출)

- 시스템 콜은 커널이 제공하는 시스템 자원의 사용과 연관된 함수이다.
- 응용 프로그램이 하드웨어 자원에 접근하거나 운영체제가 제공하는 서비스를 이용하려 할 때는 시스템 콜을 사용해야 한다.
- 운영체제는 커널이 제공하는 서비스를 시스템 콜로 제한하고 다른 방법으로 커널에 들어오지 못하게 막음으로써 컴퓨터 자원을 보호한다.
- 시스템 콜은 커널이 제공하는 서비스를 이용하기 위한 인터페이스이며, 사용자가 자발적으로 커널 영역에 진입할 수 있는 유일한 수단이다.







##  컴퓨터의 요소



컴퓨터는 CPU, DMA 컨트롤러, 메모리, 타이머, 디바이스 컨트롤러 등으로 이루어져 있다.



## CPU

**CPU**(Central Processing Unit)는 **산술논리연산장치**, **제어장치**, **레지스터로** 구성되어 있다.
인터럽트에 의해 메모리에 존재하는 명령어를 해석해 실행한다.

* 운영체제의 커널이 프로그램을 **메모리에 올려** 프로세스로 만들면 일꾼인 CPU가 처리한다.

### 제어장치

**제어장치**는 프로세스 조작을 지시하는 CPU의 한 부품이다. 입출력장치 간 통신을 제어하고 명령어들을 읽고 해석하며 데이터 처리를 위한 순서를 결정한다.

### 레지스터

**레지스터**는 CPU 안에 있는 매우 빠른 임시기억장치이다. CPU와 직접 연결되어 있어 연산 속도가 메모리보다 수십 배에서 수백 배까지 빠르다. CPU는 자체적으로 데이터를 저장할 방법이 없기 때문에 레지스터를 거쳐 데이터를 전달한다.

### 산술논리연산장치

산술논리연산장치(ALU)는 덧셈, 뺄셈 같은 두 숫자의 산술 연산과 베타적 논리합, 논리곱 같은 논리 연산을 처리하는 디지털 회로다.

#### CPU의 연산 처리

CPU에서 제어장치, 레지스터, 산술논리연산장치를 통해 연산하는 과정이다.

1. 제어장치가 메모리에 계산할 값을 로드한다. 또한 레지스터에도 로드한다.
2. 제어장치가 레지스터에 있는 값을 계산하라고 산술논리연산장치에 명령한다.
3. 제어장치가 계산된 값을 다시 레지스터에서 메모리로 저장한다



### 인터럽트

인터럽트는 어떤 신호가 들어왔을 때 CPU를 잠시 정지시키는 것을 말한다.
인터럽트가 발생되면 인터럽트 핸들러 함수가 모여 있는 인터럽트 벡터로 가서 인터럽트 핸들러 함수가 실행된다. 인터럽트 간에는 우선순위가 있고 우선순위에 따라 실행되며 인터럽트는 하드웨어 인터섭트, 소프트웨어 인터럽트 두 가지로 나뉜다.

* 키보드 마우스 등 I/O 인터럽트
* 0으로 숫자를 나누는 산술 연산에서의 인터럽트 - 예외, 트랩
* 프로세스 오류 등으로 인한 인터럽트



인터럽트가 발생되면 인터럽트 핸들러 함수가 모여있는 인터럽트 벡터에서 인터럽트 핸들러 함수가 실행된다.  
인터럽트간에는 우선순위가 있고 우선순위에 따라 실행된다.

* 인터럽트 핸들러 함수 : 인터럽트 발생 시 핸들링하기 위한 함수. 커널 내부의 IRQ를 통해 호출되며 request_ireq() 함수를 통해 인터럽트 핸들러 함수를 등록할 수 있다





#### 하드웨어 인터럽트

하드웨어 인터럽트는 키보드를 연결한다거나 마우스를 연결하는 일 등의 IO 디바이스에서 발생하는 인터럽트다.

#### 소프트웨어 인터럽트

소프트웨어 인터럽트는 트랩 이라고도 한다. 프로세스 오류 등으로 프로세스가 시스템콜을 호출할 떄 발생한다.

## DMA 컨트롤러 (입출력장치가 메모리에 직접 접근)

DMA(Direct Memory Access) 컨트롤러는 I/O **디바이스가 메모리에 직접 접근**할 수 있도록 하는 하드웨어 장치를 뜻한다.
CPU에만 너무 많은 인터럽트 요청이 들어오기 때문에 CPU 부하를 막아준다.

* 또한 하나의 작업을 CPU와 DMA 컨트롤러가 동시에 하는것을 방지한다.



### 메모리

메모리는 전자회로에서 데이터나 상태, 명령어 등을 기록하는 장치를 말한다. 보통 RAM이라고 한다.

### 디바이스 컨트롤러

컴퓨터와 연결되어 있는 IO디바이스들의 작은 CPU



