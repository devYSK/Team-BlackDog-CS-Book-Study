# 조인의 원리

중첩 루프 조인, 정렬 병합 조인, 해시 조인 원리 기반으로 조인된다.

중첩 루프 조인

이중 for문과 같은 원리로 조건에 맞는 조인을 하는 방식.

랜덤 접근에 대한 비용이 많이 증가하므로 대용량의 테이블에서는 사용하지 않는다. (인덱스에 의한 랜덤 접근 기반)

```sql
for(i=0; i<dept.length; i++) { -- driving table
    for(j=0; j<emp.length; j++) { -- driven table
       // Search
    }
}
```

정렬 병합 조인

조회의 범위가 많을 때 주로 사용하는 조인 방법론.

각각의 테이블을 **조인할 필드 기준**으로 정렬하고 정렬이 끝난 이후 조인 작업을 수행.

조인할때 쓸 적절한 인덱스가 없을때, 범위 비교 연산자가 있을때 사용된다.

1. 각 테이블에 대해 동시에 독립적으로 데이터를 읽는다.
2. 읽혀진 각 테이블을 조인의 연결고리에 대해 정렬을 수행한다.
3. 정렬이 모두 끝난 후 병합한다.

해시 조인

해시 테이블 기반으로 조인하는 방법.

두개의 테이블을 조인할때, 하나의 테이블이 메모리에 온전히 들어간다면 중첩 루프 조인보다 효율적이다.

(메모리에 올릴 수 없을 정도로 크다면 디스크를 사용하는 비용이 발생한다.)

또한 동등 조인(=) 에서만 사용할 수 있다.

(해시 테이블은 기본적으로 등호 연산에 특화되어있어 부등호 연산이 자주 사용되는 검색에 적합하지 않다.)

MySQL은 8.0.18 릴리스부터 이 기능을 사용할 수 있게 되었으며, 해시 조인 단계는 빌드 단계, 프로브 단계로 나뉜다.

1. **빌드 단계**

   입력 테이블 중 하나를 기반으로 메모리 내 해시 테이블을 빌드하는 단계.

   : join 하는 두개의 테이블 중 바이트가 더 작은 데이블을 기반으로 테이블을 빌드한다.

   : join에 사용되는 필드가 해시 테이블의 키로 사용된다.

1. **프로프 단계**

   프로브 단계 동안 레코드를 읽기 시작하면, 각 레코드에 join 필드와 일치라는 레코드를 찾아 결과값으로 반환한다.
